description: >
  Runs tests using the provided configuration parameters

docker:
  - image: cimg/openjdk:17.0

parameters:
  host:
    type: string
    description: 'IP address or DNS name of the XMPP service to run the tests on.'
    default: '127.0.0.1'
  domain:
    type: string
    description: 'XMPP domain name of server under test'
    default: 'example.org'
  timeout:
    type: string
    description: 'Amount of milliseconds after which an XMPP action (typically an IQ request) is considered timed out.'
    default: '5000'
  adminAccountUsername:
    type: string
    description: 'Account name of a pre-existing user that is allowed to create other users, per XEP-0133. If not provided, In-band registration (XEP-0077) will be used.'
    default: ''
  adminAccountPassword:
    type: string
    description: 'Password for the admin account.'
    default: ''
  accountOneUsername:
    type: string
    description: 'The first account name of a set of three accounts used for testing.'
    default: ''
  accountOnePassword:
    type: string
    description: 'The password of the accountOneUsername account'
    default: ''
  accountTwoUsername:
    type: string
    description: 'The second account name of a set of three accounts used for testing.'
    default: ''
  accountTwoPassword:
    type: string
    description: 'The password of the accountTwoUsername account'
    default: ''
  accountThreeUsername:
    type: string
    description: 'The third account name of a set of three accounts used for testing.'
    default: ''
  accountThreePassword:
    type: string
    description: 'The password of the accountThreeUsername account'
    default: ''
  disabledSpecifications:
    type: string
    description: 'A comma-separated list of specifications (not case-sensitive) that are to be skipped. For example: XEP-0045,XEP-0060'
    default: ''
  disabledTests:
    type: string
    description: 'Comma-separated list of tests that are to be skipped (eg: "EntityCapsTest,SoftwareInfoIntegrationTest")'
    default: ''
  enabledSpecifications:
    type: string
    description: 'A comma-separated list of specifications (not case-sensitive) that are to be run. For example: XEP-0045,XEP-0060'
    default: ''
  enabledTests:
    type: string
    description: 'Comma-separated list of tests that are to be run (eg: "EntityCapsTest,SoftwareInfoIntegrationTest")'
    default: ''
  logDir:
    type: string
    description: 'The directory in which the test output and logs are to be stored. This directory will be created, if it does not already exist.'
    default: './output'

steps:
  - test:
      host: << parameters.host >>
      domain: << parameters.domain >>
      timeout: << parameters.timeout >>
      adminAccountUsername: << parameters.adminAccountUsername >>
      adminAccountPassword: << parameters.adminAccountPassword >>
      accountOneUsername: << parameters.accountOneUsername >>
      accountOnePassword: << parameters.accountOnePassword >>
      accountTwoUsername: << parameters.accountTwoUsername >>
      accountTwoPassword: << parameters.accountTwoPassword >>
      accountThreeUsername: << parameters.accountThreeUsername >>
      accountThreePassword: << parameters.accountThreePassword >>
      disabledSpecifications: << parameters.disabledSpecifications >>
      disabledTests: << parameters.disabledTests >>
      enabledSpecifications: << parameters.enabledSpecifications >>
      enabledTests: << parameters.enabledTests >>
      logDir: << parameters.logDir >>
